<template>
    <div class="content">
        <div class="boxed">
            <h2 class="page_h2">{{ tournament.title }} #{{ tournament.id }}</h2>
            <div class="module">
                <div class="tour-timer">–ù–∞—á–∞–ª–æ {{ tournament.date }} –≤ {{ tournament.at }}</div>
            </div>
            <div>
                <div class="tournament clear clock">
                    <div class="time-fragment">
                        <div class="head">{{ countdown.days }}</div>
                        <div class="descr">–¥–Ω–µ–π</div>
                    </div>
                    <div class="dots">:</div>
                    <div class="time-fragment">
                        <div class="head">{{ countdown.hours }}</div>
                        <div class="descr">—á–∞—Å–æ–≤</div>
                    </div>
                    <div class="dots">:</div>
                    <div class="time-fragment">
                        <div class="head">{{ countdown.minutes }}</div>
                        <div class="descr">–º–∏–Ω—É—Ç</div>
                    </div>
                    <div class="dots">:</div>
                    <div class="time-fragment">
                        <div class="head">{{ countdown.seconds }}</div>
                        <div class="descr">—Å–µ–∫—É–Ω–¥</div>
                    </div>
                </div>
                <div class="tournament clear fond">
                    <h2 class="fond-h2">–ü—Ä–∏–∑–æ–≤–æ–π —Ñ–æ–Ω–¥</h2>
                    <span class="fond_title">–§–æ–Ω–¥ —Ç—É—Ä–Ω–∏—Ä–∞ –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å—Å—è –ø–æ –º–µ—Ä–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏–≥—Ä–æ–∫–æ–≤</span>
                    <div class="fond-value">{{ tournament.participant_count > 0 ? tournament.participant_count * 100 : 200 }} points</div>
                </div>
                <div class="module">
                    <p class="descr">
                        –§–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è —Ñ–æ–Ω–¥ —Ç—É—Ä–Ω–∏—Ä–∞, –∫–æ—Ç–æ—Ä—ã–π —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ Buy-in (100 –æ—á–∫–æ–≤), Re-entry (100 –æ—á–∫–æ–≤) –∏ Add-on (200 –æ—á–∫–æ–≤).
                    </p>
                    <p class="descr">
                        üî•–ü–æ –æ–∫–æ–Ω—á–∞–Ω–∏–∏ —Ç—É—Ä–Ω–∏—Ä–∞ —Å—É–º–º–∏—Ä—É—é—Ç—Å—è –≤—Å–µ –æ—á–∫–∏ –∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –ø–æ –ø—Ä–æ—Ü–µ–Ω—Ç–∞–º, —Å–æ–≥–ª–∞—Å–Ω–æ –ø—Ä–∏–∑–æ–≤—ã–º –º–µ—Å—Ç–∞–º: 1 - 25%, 2 - 15%, 3 - 10%, 4 - 8%, 5 - 7%, 6 - 6%, 7 - 5%, 8 - 4%, 9 - 3%, —Å 10 –¥–æ 13 - 2,5%, —Å 14 –¥–æ 17 - 1,5%, 18 - 1%¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†
                    </p>
                    <p class="descr">
                        üî•–ï—Å–ª–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤,  —É—á–∞—Å—Ç–≤—É—é—â–∏—Ö –≤ —Ç—É—Ä–Ω–∏—Ä–µ, –Ω–µ –ø—Ä–µ–≤—ã—à–∞–µ—Ç 18 —á–µ–ª–æ–≤–µ–∫, —Ä–µ–π—Ç–∏–Ω–≥ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø–æ —Å–∏—Å—Ç–µ–º–µ –≤—ã—à–µ, –∏ –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –æ—á–∫–∏ –¥–µ–ª—è—Ç—Å—è –Ω–∞ –≤—Å–µ—Ö –ø–æ—Ä–æ–≤–Ω—É –∏ –æ–∫—Ä—É–≥–ª—è—é—Ç—Å—è –≤ –±–æ–ª—å—à—É—é —Å—Ç–æ—Ä–æ–Ω—É –¥–æ —Ä–æ–≤–Ω–æ–π –µ–¥–∏–Ω–∏—Ü—ã.
                    </p>
                </div>
                <div class="module">
                    <h3>–û–ø–∏—Å–∞–Ω–∏–µ —Ç—É—Ä–Ω–∏—Ä–∞</h3>

                    <div v-for="type in tournament.types">
                        <p class="descr">
                            <span style="font-weight: bold;color: white;">{{ type.title }}</span> - {{ type.description }}
                        </p>
                    </div>
                </div>
                <div class="tournament clear stat">
                    <div class="stat-elem">
                        <div class="left">–°—Ç–µ–∫</div>
                        <div class="right">{{ tournament.stack }} ({{ tournament.small_blind }}/{{ tournament.big_blind }}/{{ tournament.ante }})</div>
                    </div>
                    <div class="stat-elem">
                        <div class="left">Buy-in</div>
                        <div class="right">{{ !tournament.free_entry ? tournament.buy_in + '‚ÇΩ' : '–ë–µ—Å–ø–ª–∞—Ç–Ω–æ' }}</div>
                    </div>
                    <div class="stat-elem">
                        <div class="left">Re-Entry</div>
                        <div class="right">{{ !tournament.without_re_entry ? tournament.re_entry + '‚ÇΩ' : '–ë–µ–∑ re-enty' }}</div>
                    </div>
                    <div class="stat-elem">
                        <div class="left">Add-on</div>
                        <div class="right">{{ !tournament.without_add_on ? tournament.add_on + '‚ÇΩ' : '–ë–µ–∑ add-on' }}</div>
                    </div>
                </div>
                <div v-if="tournament.is_private" class="module">
                    <div  class="butt private_tournament" >
                        –£—á–∞—Å—Ç–∏–µ –ø–æ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—é –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–∏
                    </div>
                </div>
                <div v-if="!tournament.is_private" class="module">
                    <button @click="joinTournament(tournament.id)" v-if="!tournament.participant" class="join-button" style="width: 100%">–ü—Ä–∏–Ω—è—Ç—å —É—á–∞—Å—Ç–∏–µ</button>
                    <div v-if="tournament.participant" class="butt" style="text-align: center; margin-bottom: 15px">–í—ã –∑–∞–ø–∏—Å–∞–Ω—ã, –∂–¥–µ–º –≤–∞—Å –Ω–∞ –∏–≥—Ä—É!</div>
                    <button @click="leaveTournament(tournament.id)" v-if="tournament.participant" class="join-button cancel" style="width: 100%">–û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å</button>
                </div>
            </div>
        </div>
    </div>
</template>

<script>

export default {
    data: function () {
        return {
            tournament:{
                title:null,
                id:null,
            },
            countdown: {
                days: '00',
                hours: '00',
                minutes: '00',
                seconds: '00',
            },
            countdownTimerId: null,
        }
    },
    methods:{
        async getTournament(){
            try{
                const { data } = await axios({
                    method: 'POST',
                    url: '/api/tournament/'+ this.$route.params.id +'/get',
                });
                this.tournament = data.data

                this.startCountdown();   // start timer after data is loaded

                return true;
            } catch (error) {
                return false;
            }
        },

        async leaveTournament(id){
            try{
                const { data } = await axios({
                    method: 'POST',
                    url: '/api/tournament/'+id+'/leave',
                    // headers:{
                    //     Authorization:'Bearer '+localStorage.getItem('_token'),
                    // },
                });
                this.tournament.participant = false

                return true;
            } catch (error) {
                return false;
            }
        },

        startCountdown() {
            if (this.countdownTimerId) {
                clearInterval(this.countdownTimerId);
            }

            this.updateCountdown(); // initial calculation

            this.countdownTimerId = setInterval(() => {
                this.updateCountdown();
            }, 1000);
        },

        updateCountdown() {
            if (!this.tournament || !this.tournament.at) {
                return;
            }

            // If instead date and time are separate, use this form:
            let target = new Date(this.tournament.at_date);
            console.log(target);
            const now = new Date();
            let diffMs = target.getTime() - now.getTime();

            if (diffMs <= 0) {
                diffMs = 0;
                if (this.countdownTimerId) {
                    clearInterval(this.countdownTimerId);
                    this.countdownTimerId = null;
                }
            }

            const totalSeconds = Math.floor(diffMs / 1000);
            const days = Math.floor(totalSeconds / (24 * 60 * 60));
            const hours = Math.floor((totalSeconds % (24 * 60 * 60)) / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;

            this.countdown.days = String(days).padStart(2, '0');
            this.countdown.hours = String(hours).padStart(2, '0');
            this.countdown.minutes = String(minutes).padStart(2, '0');
            this.countdown.seconds = String(seconds).padStart(2, '0');
        }
    },
    computed:{

    },
    mounted() {
        this.getTournament()
    },
    beforeDestroy() {
        if (this.countdownTimerId) {
            clearInterval(this.countdownTimerId);
        }
    }
}
</script>

<style>

</style>
